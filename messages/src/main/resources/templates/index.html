<!DOCTYPE html>
<html>
<head>
  <title>Messages App</title>
  <style> 
    body > div {width:500px; margin: 0 auto; }
    textarea {width:100%;}
    ul {padding: 0 15px;}
  </style>
</head>
<body>
  <div id="app">
    <message-list :items="messages" @delete="deleteMessage"></message-list>                      <!-- 컴포넌트 사용 -->
    <form @submit.prevent="addMessage">                        <!-- submit 이벤트가 트리거될 때, 메서드를 호출하지만, 브라우저가 폼을 제출하지 않음 -->
      <textarea id="newMessage" v-model="newMessage" placeholder="Leave a message"></textarea>
      <div><button v-bind:disabled="addDisabled" type="submit">Add</button></div>                <!-- submit 이벤트를 트리거하는 버튼 -->
    </form>
  </div> 

  <script src="../vue.js"></script>  <!-- 스크립트로 vue 참조 --> 
  <script src="../axios.v0.18.0.min.js"></script>
  <script type="module">  // MessageList를 ES6 모듈로 생성했기 때문에, type="module"을 추가하고, 컴포넌트를 가져와야한다.
  import MessageList from './components/MessageList.js';
  //import LifecycleLogger from './plugins/lifecycle-logger.plugin.js'
  //import './directives/focus.directive.js';

  // Vue.use(LifecycleLogger, { beforeMount: false })  // 플러그인 사용

    window.vm = new Vue({
      el: '#app',
      name: 'MessagesApp',
      // mixins: [lifecycleLogger],

      created() {
        axios.get('api/messages?_=' + new Date().getTime()).then((response) => {
          this.messages = response.data
        })
      },
      components: {
        MessageList       // MessageList:MessageList의 축약 표현
      },
      data() {            // 컴포넌트에 대한 데이터 구조를 정의할 때 함수를 사용하는 것이 필수, 항상 이 함수로 컴포넌트에 대한 새로운 데이터 모델을 생성하기 때문이다.
        return {          // 일반 객체를 사용하면, 이 컴포넌트의 모든 인스턴스가 같은 data 객체를 공유하게 된다. (루트 인스턴스만은 상관 없다)
          messages: [],
          newMessage: ''
        }
      },
      methods: {              // 메서드를 만드는데 화살표 함수 구문을 사용하면 안된다. this로 Vue 인스턴스에 접근할 수 없기 때문
        addMessage (event) {
          if(!this.newMessage) return;
          axios.post('/api/messages', { text: this.newMessage })
          .then((response) => {
            this.messages.push(response.data)
            this.newMessage = ''
          })
        },
        deleteMessage (message) {
          this.messages.splice(this.messages.indexOf(message),1);
        }
      },
      computed: {
        addDisabled() {
          return this.messages.length >= 10 || this.newMessage.length > 50;
        }
      }
    });
  </script>
</body>
</html>